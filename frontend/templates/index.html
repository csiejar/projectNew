<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¡Œåº«ç³»çµ±</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{{ url_for('static', path='/styles.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <!-- Sidebar -->
  <div class="sidebar closed" id="sidebar">
    <div class="sidebar-logo">
      <img src="../static/img/mark.png" alt="Logo">
    </div>
    <ul>
      <li id="mainPageSideBar"><i class="bi bi-house"></i> <span class="text">é¦–é </span></li>
      <li id="questionBankSideBar"><i class="bi bi-book"></i> <span class="text">é¡Œåº«</span></li>
      <li id="demoTestSideBar"><i class="bi bi-pencil"></i> <span class="text">æ¨¡æ“¬æ¸¬é©—</span></li>
      <li id="WrongQuestionBookSideBar"><i class="bi bi-journal-x"></i> <span class="text">éŒ¯é¡Œæœ¬</span></li>
      <li id="correctRateSideBar"><i class="bi bi-pie-chart"></i> <span class="text">å¼±é»åˆ†æ</span></li>
    </ul>
  </div>

  <div class="toggle-button" id="toggleButton">
    <div class="bar top"></div>
    <div class="bar middle"></div>
    <div class="bar bottom"></div>
  </div>

  <!-- Header -->
  <header class="d-flex align-items-center justify-content-between p-3 bg-white text-dark">
    <button class="btn text-dark" id="menuBtn">â˜°</button>
    <img src="../static/img/logo.png" alt="Logo" style="height: 50px;" onclick="location.href='/'">
    <div>
      <button class="btn btn-outline-dark" id="google-translate">
        <i class="bi bi-globe"></i>
      </button>
      <div id="google_translate_element"
        style="display: none; position: absolute; top: 80px; right: 0px; z-index: 10000;"></div>
      <script type="text/javascript">
        document.getElementById('google_translate_element').style.display = 'none';
        function googleTranslateElementInit() {
          new google.translate.TranslateElement({
            pageLanguage: 'zh-TW',
            includedLanguages: 'en,zh-CN,zh-TW',
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE
          }, 'google_translate_element');
        }
        document.getElementById('google-translate').addEventListener('click', function () {
          const translateElement = document.getElementById('google_translate_element');
          translateElement.style.display = translateElement.style.display === 'none' ? 'block' : 'none';
        });
      </script>
      <script type="text/javascript"
        src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
      <button class="btn btn-outline-dark" id="userBtn">
        <i class="bi bi-person-circle"></i>
      </button>
    </div>
  </header>

  <!-- ä¸»å…§å®¹å€åŸŸ -->
  <div class="main-content">
    <div class="container-fluid">
      <h1 class="fw-bold mb-4">é›»å­å­¸é¡Œåº«ç³»çµ±</h1>
      <p class="fs-5 mt-4" style="color: #444;">æœ¬ç¶²ç«™æä¾›å„å¼é¡Œåº«ï¼Œæä¾›å€‹äººåŒ–çš„é›»å­å­¸ç·´ç¿’åŠæ¨¡æ“¬è©¦é¡Œ</p>
      <div class="loginOutBtn">
        <button id="buttonLogin">Login</button>
        <button id="buttonLogout" style="display: none;">Logout</button>
      </div>
    <script>
      document.getElementById('buttonLogin').addEventListener('click', function() {
        fetch('/api/authUser', { method: 'GET', credentials: 'include' })
        .then(res => res.json())
        .then(data => {
          if (data.message === "å·²ç™»å…¥") {
            document.getElementById("userAvatar").src = data.userData.userImg || "../static/img/default-avatar.png";
            document.getElementById("userName").textContent = data.userData.name;
            document.getElementById("userEmail").textContent = data.userData.email;
            document.getElementById("g_id_onload").style.display = "none";
            document.getElementById("loginBtn").style.display = "none";
            userInfoOverlay.style.display = "flex";
          }
          else {
            document.getElementById("userAvatar").src = "../static/img/default-avatar.png";
            document.getElementById("userName").textContent = "æ‚¨å°šæœªç™»å…¥";
            document.getElementById("userEmail").textContent = "ç™»å…¥å¾Œå³é¡¯ç¤º";
            document.getElementById("logoutFromCard").style.display = "none";
            userInfoOverlay.style.display = "flex";
          }
        })
        .catch(err => console.error("å–å¾—ä½¿ç”¨è€…è³‡è¨Šå¤±æ•—:", err));
      });
    </script>
    </div>
  </div>

  <!-- æ–°å¢é›»è·¯åœ–åœ–ç‰‡ -->
  <div class="announcemaent main-content">
    <div class="container-fluid">
      <img src="../static/img/damn.png " alt="damn" class="img-fluid">
    </div>
  </div>

  <!-- ç§‘ç›®ä¸»é¡Œå€åŸŸ -->
  <div class="mt-4 main-content">
    <div class="container-fluid">
      <h1 class="fw-bold">ç§‘ç›®ä¸»é¡Œ</h1>
      <div id="carouselSubjects" class="carousel slide mt-4" data-bs-ride="carousel">
        <div class="carousel-inner" id="subjectCarousel">
          <!-- é€™è£¡çš„å…§å®¹ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
        <a class="carousel-control-prev d-none d-md-flex" href="#carouselSubjects" role="button" data-bs-slide="prev" style="left: -125px;">
          <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: invert(1);"></span>
        </a>
        <a class="carousel-control-next d-none d-md-flex" href="#carouselSubjects" role="button" data-bs-slide="next" style="right: -100px;">
          <span class="carousel-control-next-icon" aria-hidden="true" style="filter: invert(1);"></span>
        </a>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // å‘¼å«å¾Œç«¯ API å–å¾—ç§‘ç›®è³‡æ–™
      fetch('/api/getAllTopics') // é€™è£¡çš„ URL æ˜¯å¾Œç«¯ API çš„è·¯å¾‘
        .then(response => response.json())
        .then(topics => {
          const carouselInner = document.getElementById("subjectCarousel");
          for (let i = 0; i < topics.length; i += 3) {
            let activeClass = i === 0 ? "active" : "";
            let items = topics.slice(i, i + 3).map(topic => `
              <div class="col flex-grow-1" style="padding: 0 1px;">
                <div class="card" style="width: 95%; margin: 0 auto;">
                  <img src="/static/img/${topic.img}.png" class="card-img-top" alt="${topic.title}" style="height: 150px;">
                  <div class="card-body">
                    <h5 class="card-title">${topic.title}</h5>
                    <p class="card-text">${topic.content}</p>
                    <a href="${topic.link}" class="btn btn-primary">å‰å¾€å­¸ç¿’</a>
                  </div>
                </div>
              </div>`).join('');

            carouselInner.innerHTML += `<div class="carousel-item ${activeClass}"><div class="row g-0 justify-content-center" style="max-width: 90%; margin: 0 auto;">${items}</div></div>`;
          }
        })
        .catch(error => console.error('Error fetching topics:', error));
    });
  </script>

  <!-- å…¬å‘Šèˆ‡æ›´æ–° -->
  <div class="mt-4 main-content">
    <div class="container-fluid">
      <h1 class="fw-bold">å…¬å‘Šèˆ‡æ›´æ–°</h1>
      <p class="fs-5" style="color: #444;">
        æœ€æ–°å…¬å‘Šï¼šæœ¬ç¶²ç«™å°‡æ–¼ 2025 å¹´ 5 æœˆ 1 æ—¥é€²è¡Œç³»çµ±å‡ç´šï¼Œå±†æ™‚éƒ¨åˆ†åŠŸèƒ½å¯èƒ½æœƒæš«åœï¼Œè«‹ä½¿ç”¨è€…è¦‹è«’ã€‚
      </p>
      <p class="fs-5" style="color: #444;">
        æ›´æ–°å…§å®¹ï¼šæ–°å¢ã€Œé€²éšæ¨¡æ“¬æ¸¬é©—ã€åŠŸèƒ½ï¼Œæä¾›æ›´å¤šé¡Œå‹èˆ‡å³æ™‚è§£æã€‚
      </p>
    </div>
  </div>

  <!-- **æŒ‰éˆ•å€å¡Šï¼Œèˆ‡å…¬å‘Šå…§å®¹å®Œå…¨å°é½Š** -->
  <div class="main-content">
    <div class="container-fluid">
      <div class="row mt-3">
        <div class="col text-center">
          <a href="https://forms.gle/Ubs1ynuFGzoRnDxRA" class="btn btn-outline-primary me-3 px-4 mb-2" target="_blank">æ„è¦‹å›é¥‹</a>
          <a href="mailto:hankbeststudents@gmail.com?subject=å°ˆé¡Œç¶²ç«™-é¡Œåº«ç³»çµ± å•é¡Œ" class="btn btn-outline-secondary px-4 mb-2">è¯çµ¡æˆ‘å€‘</a>
        </div>
      </div>
    </div>
  </div>

</body>
</html>

  <!-- å¼•å…¥ Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ç™»å…¥å½ˆå‡ºè¦–çª—ï¼ˆå¯æ‹–å‹•ï¼‰ -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <!-- Google ç”¢ç”Ÿçš„ç™»å…¥æŒ‰éˆ• -->
      
  
      <!-- ç™»å‡ºæŒ‰éˆ• -->
      <button id="logoutBtn" class="logout-button" style="display: none;">ç™»å‡º</button>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const loginButton = document.getElementById("loginBtn");
      const logoutButton = document.getElementById("logoutBtn");
      const logoutButtonMainPage = document.getElementById("buttonLogout");
      const loginButtonMainPage = document.getElementById("buttonLogin");
      
      logoutButton.addEventListener("click", function () {
        logout();
      });
      logoutButtonMainPage.addEventListener("click", function () {
        logout();
      });

      // æª¢æŸ¥ URL æ˜¯å¦åŒ…å«åˆ·æ–°æ¨™è¨˜
      const urlParams = new URLSearchParams(window.location.search);
      const refreshed = urlParams.get('refreshed');
  
      if (refreshed === 'true') {
        console.log("å·²åˆ·æ–°éé é¢ï¼ŒåŸ·è¡Œæª¢æŸ¥ç™»å…¥ç‹€æ…‹");
        checkAuthStatus(); // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
      } else {
        checkAuthStatus(); // åˆå§‹åŒ–æª¢æŸ¥ç™»å…¥ç‹€æ…‹
      }
  
      // çµ±ä¸€æª¢æŸ¥ç™»å…¥ç‹€æ…‹çš„å‡½æ•¸
      function checkAuthStatus() {
        fetch('/api/authUser', { method: 'GET', credentials: 'include' })
          .then(response => response.json())
          .then(data => {
            if (data.message === "å·²ç™»å…¥") {
              loginButton.style.display = "none";
              logoutButton.style.display = "block";
              loginButtonMainPage.style.display = "none";
              logoutButtonMainPage.style.display = "flex";
              console.log("ç”¨æˆ¶è³‡æ–™:", data.userData);
            } else {
              loginButton.style.display = "block";
              logoutButton.style.display = "none";
              loginButtonMainPage.style.display = "flex";
              logoutButtonMainPage.style.display = "none";
              console.log("ç”¨æˆ¶æœªç™»å…¥");
            }
          })
          .catch(error => console.error('Error fetching authUser:', error));
      }
  
      function logout() {
        fetch('/api/logout', { method: 'POST', credentials: 'include' })
          .then(response => response.json())
          .then(result => {
            if (result.message === "ç™»å‡ºæˆåŠŸ") {
              window.location.reload(); // åˆ·æ–°é é¢
            }
          })
          .catch(error => console.error('ç™»å‡ºå¤±æ•—:', error));
      }
    });
  </script>
  
  

  <!-- Footer -->
  <div id="footer" style="cursor: pointer;">
    <p>Â© 2025 Elec Forge ç‰ˆæ¬Šæ‰€æœ‰</p>
  </div>

  <script src="../static/script.js"></script>

  <!-- æ”¾åœ¨ body çš„æœ€ä¸‹æ–¹ï¼Œfooter ä¹‹å‰ -->
<div class="overlay" id="userInfoOverlay" style="display: none;">
  <div class="popup-card">
    <button class="close-btn" id="closeUserCard">âœ•</button>
    <img id="userAvatar" src="" alt="ä½¿ç”¨è€…é ­åƒ" class="avatar">
    <div class="name" id="userName">ä½¿ç”¨è€…å§“å</div>
    <div class="email" id="userEmail">ä½¿ç”¨è€… Gmail</div>
    <div id="g_id_onload" data-client_id="1071265157577-7bcbr8qejtvtbmnchgs06ohr9ke46v97.apps.googleusercontent.com"
        data-callback="handleCredentialResponse" data-auto_select="true">
      </div>
      <div id="loginBtn" class="g_id_signin" data-type="standard"></div>
    <button class="button logout-only" id="logoutFromCard">ç™»å‡ºå¸³æˆ¶</button>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const loginButton = document.getElementById("loginBtn");
    const logoutButton = document.getElementById("logoutBtn");
    const logoutButtonMainPage = document.getElementById("buttonLogout");
    const loginButtonMainPage = document.getElementById("buttonLogin");
    const userBtn = document.getElementById("userBtn");
    const userInfoOverlay = document.getElementById("userInfoOverlay");
    const closeUserCard = document.getElementById("closeUserCard");

    logoutButton.addEventListener("click", logout);
    logoutButtonMainPage.addEventListener("click", logout);

    userBtn.addEventListener("click", function () {
      fetch('/api/authUser', { method: 'GET', credentials: 'include' })
        .then(res => res.json())
        .then(data => {
          if (data.message === "å·²ç™»å…¥") {
            document.getElementById("userAvatar").src = data.userData.userImg || "../static/img/default-avatar.png";
            document.getElementById("userName").textContent = data.userData.name;
            document.getElementById("userEmail").textContent = data.userData.email;
            document.getElementById("g_id_onload").style.display = "none";
            document.getElementById("loginBtn").style.display = "none";
            userInfoOverlay.style.display = "flex";
          }
          else {
            document.getElementById("userAvatar").src = "../static/img/default-avatar.png";
            document.getElementById("userName").textContent = "æ‚¨å°šæœªç™»å…¥";
            document.getElementById("userEmail").textContent = "ç™»å…¥å¾Œå³é¡¯ç¤º";
            document.getElementById("logoutFromCard").style.display = "none";
            userInfoOverlay.style.display = "flex";
          }
        })
        .catch(err => console.error("å–å¾—ä½¿ç”¨è€…è³‡è¨Šå¤±æ•—:", err));
    });

    // é—œé–‰å¡ç‰‡æŒ‰éˆ•
    closeUserCard.addEventListener("click", function() {
      userInfoOverlay.classList.add('fade-out');
      setTimeout(() => {
        userInfoOverlay.style.display = 'none';
        userInfoOverlay.classList.remove('fade-out');
      }, 300);
    });

    // é»æ“Šé®ç½©é—œé–‰
    userInfoOverlay.addEventListener("click", function(event) {
      if (event.target === userInfoOverlay) {
        userInfoOverlay.classList.add('fade-out');
        setTimeout(() => {
          userInfoOverlay.style.display = 'none';
          userInfoOverlay.classList.remove('fade-out');
        }, 300);
      }
    });

    // ç™»å‡ºæŒ‰éˆ•
    document.getElementById("logoutFromCard").addEventListener("click", logout);

    // ESC éµé—œé–‰å½ˆçª—
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && userInfoOverlay.style.display === 'flex') {
        userInfoOverlay.classList.add('fade-out');
        setTimeout(() => {
          userInfoOverlay.style.display = 'none';
          userInfoOverlay.classList.remove('fade-out');
        }, 300);
      }
    });

    // Footer é»æ“Šäº‹ä»¶ - æ¸¬è©¦ç”¨åŠŸèƒ½ï¼ˆéœ€è¦é€£çºŒé»æ“Š5æ¬¡ï¼‰
    let footerClickCount = 0;
    let footerClickTimeout = null;
    
    document.getElementById('footer').addEventListener('click', function() {
      footerClickCount++;
      
      // æ¸…é™¤ä¹‹å‰çš„è¶…æ™‚è¨ˆæ™‚å™¨
      if (footerClickTimeout) {
        clearTimeout(footerClickTimeout);
      }
      
      // å¦‚æœé”åˆ°5æ¬¡é»æ“Š
      if (footerClickCount >= 5) {
        document.cookie = "sessionToken=session-0a744ec6-519e-4465-8481-c523e1370870";
        console.log("æ¸¬è©¦ Cookie å·²è¨­ç½®: sessionToken=session-0a744ec6-519e-4465-8481-c523e1370870");
        alert("ğŸ‰ æ¸¬è©¦æ¨¡å¼å·²æˆåŠŸå•Ÿç”¨ï¼\næ¸¬è©¦ Cookie å·²è¨­ç½®ï¼Œæœ‰æ•ˆæœŸ 24 å°æ™‚ã€‚");
        footerClickCount = 0; // é‡ç½®è¨ˆæ•¸å™¨
      } else {
        // è¨­ç½®3ç§’è¶…æ™‚ï¼Œå¦‚æœ3ç§’å…§æ²’æœ‰ç¹¼çºŒé»æ“Šå°±é‡ç½®è¨ˆæ•¸å™¨
        footerClickTimeout = setTimeout(() => {
          console.log("è¶…æ™‚é‡ç½®ï¼Œé‡æ–°é–‹å§‹è¨ˆæ•¸");
          footerClickCount = 0;
        }, 3000);
      }
    });

    const urlParams = new URLSearchParams(window.location.search);
    const refreshed = urlParams.get('refreshed');

    if (refreshed === 'true') {
      checkAuthStatus();
    } else {
      checkAuthStatus();
    }

    function checkAuthStatus() {
      fetch('/api/authUser', { method: 'GET', credentials: 'include' })
        .then(response => response.json())
        .then(data => {
          if (data.message === "å·²ç™»å…¥") {
            loginButton.style.display = "none";
            logoutButton.style.display = "block";
            loginButtonMainPage.style.display = "none";
            logoutButtonMainPage.style.display = "flex";
            console.log("ç”¨æˆ¶è³‡æ–™:", data.userData);
          } else {
            loginButton.style.display = "block";
            logoutButton.style.display = "none";
            loginButtonMainPage.style.display = "flex";
            logoutButtonMainPage.style.display = "none";
            console.log("ç”¨æˆ¶æœªç™»å…¥");
          }
        })
        .catch(error => console.error('Error fetching authUser:', error));
    }

    function logout() {
      fetch('/api/logout', { method: 'POST', credentials: 'include' })
        .then(response => response.json())
        .then(result => {
          if (result.message === "ç™»å‡ºæˆåŠŸ") {
            window.location.reload();
          }
        })
        .catch(error => console.error('ç™»å‡ºå¤±æ•—:', error));
    }
  });
</script>

  <script src="{{ url_for('static', path='/script.js') }}"></script>

</body>

</html>